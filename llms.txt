# smimodel

The R package *smimodel* provides functions to estimate Sparse Multiple
Index (SMI) Models for nonparametric forecasting/prediction. The SMI
Modelling algorithm simultaneously performs optimal predictor selection
(hence “sparse”) and predictor grouping, enabling parsimonious
forecasting/prediction models in a high-dimensional context.

The package also includes functions to fit some benchmark comparison
methods namely nonparametric additive model with backward elimination,
group-wise additive index model and projection pursuit regression. These
functions are designed to have a similar syntax and output format for
convenient usage and interchangeability.

#### Additional Functionalities:

Furthermore, the smimodel package provides functions to generate
prediction intervals to estimate uncertainty of the point forecasts
produced by the SMI model and given benchmark models in time series
forecasting problems. The classical *Block Bootstrap* method and a novel
method named *Conformal Bootstrap*, which is a natural integration of
block bootstrap and classical split conformal prediction, are
implemented as prediction interval generation methods through a general
online updating procedure as introduced by Wang and Hyndman (2024)
(<https://arxiv.org/pdf/2410.13115>).

## Installation

You can install the released version of smimodel from CRAN:

``` r
install.packages("smimodel")
```

You can install the the development version of smimodel from
[GitHub](https://github.com/):

``` r
# install.packages("pak")
pak::pak("nuwani-palihawadana/smimodel")
```

## Other Required Software

### Gurobi Solver

The estimation of SMI model is based on an iterative procedure that is
developed using Mixed Integer Programming (MIP) to solve an L0 and
L2-regularised nonlinear least squares optimisation problem with linear
constraints. We use the commercial MIP solver
[*Gurobi*](https://www.gurobi.com/) to solve the mixed integer programs,
as it is the fastest and the most powerful MIP solver currently
available. Hence, the users of *smimodel* are required to have an active
installation of Gurobi in their local machines.

#### License

Since Gurobi is a commercial software, the users need to obtain a
[license for
Gurobi](https://support.gurobi.com/hc/en-us/articles/12684663118993-How-do-I-obtain-a-Gurobi-license)
before they can install/use it.

Gurobi provides free license for academics affiliated with recognised
educational institutions. Hence, if you are an academic, you can
register for a free account with your verified institutional email, and
then request a [free academic
license](https://www.gurobi.com/academia/academic-program-and-licenses/).
If you are not affiliated with a recognised educational institution, you
might need to purchase a license for long term use. However, you can
obtain a [free 30-day trial by requesting for an evaluation
license](https://www.gurobi.com/downloads/request-an-evaluation-license/).

#### Installation

Fortunately, Gurobi provides [comprehensive
documentation](https://docs.gurobi.com/current/) regarding installation
as well as usage, and provides active support at the [Gurobi Help
Center](https://support.gurobi.com/hc/en-us).

For step-by-step instructions on software installation and license
activation process, go to [this
link](https://support.gurobi.com/hc/en-us/articles/14799677517585-Getting-Started-with-Gurobi-Optimizer).
Note that the procedure for installing Gurobi depends on the operating
system that you are using in your local machine. The platform-specific
instructions can be found
[here](https://support.gurobi.com/hc/en-us/articles/4534161999889-How-do-I-install-Gurobi-Optimizer).

### R Package “gurobi”

Once Gurobi solver is installed in your local machine, next you need to
install the Gurobi R interface through “gurobi” R package, to use gurobi
within R. This package is not available on CRAN, and is exclusively
distributed with the Gurobi software suite. The instructions on how to
install the gurobi R package are provided
[here](https://support.gurobi.com/hc/en-us/articles/14462206790033-How-do-I-install-Gurobi-for-R).

## Example

This is a basic example, which shows you how to estimate a SMI model,
and obtain predictions on a test set:

``` r
library(smimodel)
library(dplyr)
library(ROI)
library(tibble)
library(tidyr)
library(tsibble)

# Simulate data
n = 1205
set.seed(123)
sim_data <- tibble(x_lag_000 = runif(n)) |> 
  mutate(
    # Add x_lags
    x_lag = lag_matrix(x_lag_000, 5)) |> 
  unpack(x_lag, names_sep = "_") |> 
  mutate(
    # Response variable
    y1 = (0.9*x_lag_000 + 0.6*x_lag_001 + 0.45*x_lag_003)^3 + rnorm(n, sd = 0.1),
    # Add an index to the data set
    inddd = seq(1, n)) |> 
  drop_na() |> 
  select(inddd, y1, starts_with("x_lag")) |> 
  # Make the data set a `tsibble`
  as_tsibble(index = inddd)

# Training set
sim_train <- sim_data[1:1000, ]
# Test set
sim_test <- sim_data[1001:1200, ]

# Index variables
index.vars <- colnames(sim_data)[3:8]
```

``` r
# Estimate SMI model (with "PPR" initialisation)
smimodel_ppr <- model_smimodel(data = sim_train,
                               yvar = "y1",
                               index.vars = index.vars,
                               initialise = "ppr")

# Fitted SMI model
smimodel_ppr$fit[[1]]$best
```

``` r
# Plot estimated smooths
autoplot(object = smimodel_ppr)
```

![](reference/figures/README-unnamed-chunk-3-1.png)

``` r

# Obtain residuals and fitted values
augment(x = smimodel_ppr)
#> # A tibble: 1,000 × 3
#>    Index  .resid .fitted
#>    <int>   <dbl>   <dbl>
#>  1     6  0.0859   0.495
#>  2     7  0.0766   0.737
#>  3     8  0.137    3.70 
#>  4     9  0.0173   1.15 
#>  5    10  0.118    0.942
#>  6    11 -0.201    3.65 
#>  7    12 -0.0471   1.83 
#>  8    13  0.0111   1.28 
#>  9    14 -0.0464   2.46 
#> 10    15  0.0243   0.261
#> # ℹ 990 more rows
```

``` r
# Obtain predictions on the test set
predict(object = smimodel_ppr, newdata = sim_test)$.predict
```

## License

This package is free and open-source software, licensed under GPL-3.

# Package index

## Estimating SMI model

Functions to estimate a SMI model with or without penalty parameter
tuning.

- [`model_smimodel()`](https://nuwani-palihawadana.github.io/smimodel/reference/model_smimodel.md)
  : Sparse Multiple Index (SMI) Models
- [`greedy_smimodel()`](https://nuwani-palihawadana.github.io/smimodel/reference/greedy_smimodel.md)
  : SMI model estimation through a greedy search for penalty parameters

## Estimating other benchmark models

Functions to fit some benchmark comparison methods.

- [`model_backward()`](https://nuwani-palihawadana.github.io/smimodel/reference/model_backward.md)
  : Nonparametric Additive Model with Backward Elimination
- [`model_gaim()`](https://nuwani-palihawadana.github.io/smimodel/reference/model_gaim.md)
  : Groupwise Additive Index Models (GAIM)
- [`model_ppr()`](https://nuwani-palihawadana.github.io/smimodel/reference/model_ppr.md)
  : Projection Pursuit Regression (PPR) models
- [`model_gam()`](https://nuwani-palihawadana.github.io/smimodel/reference/model_gam.md)
  : Generalised Additive Models
- [`model_lm()`](https://nuwani-palihawadana.github.io/smimodel/reference/model_lm.md)
  : Linear Regression models

## Augment methods

Obtain residuals and fitted values of the fitted models.

- [`augment(`*`<smimodel>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.smimodel.md)
  :

  Augment function for class `smimodel`

- [`augment(`*`<backward>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.backward.md)
  :

  Augment function for class `backward`

- [`augment(`*`<gaimFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.gaimFit.md)
  :

  Augment function for class `gaimFit`

- [`augment(`*`<pprFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.pprFit.md)
  :

  Augment function for class `pprFit`

- [`augment(`*`<gamFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.gamFit.md)
  :

  Augment function for class `gamFit`

- [`augment(`*`<lmFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.lmFit.md)
  :

  Augment function for class `lmFit`

## Predict methods

Obtain residuals and fitted values of the fitted models.

- [`predict(`*`<smimodel>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.smimodel.md)
  :

  Obtaining forecasts on a test set from a fitted `smimodel`

- [`predict(`*`<backward>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.backward.md)
  :

  Obtaining forecasts on a test set from a fitted `backward`

- [`predict(`*`<gaimFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.gaimFit.md)
  :

  Obtaining forecasts on a test set from a fitted `gaimFit`

- [`predict(`*`<pprFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.pprFit.md)
  :

  Obtaining forecasts on a test set from a fitted `pprFit`

- [`predict(`*`<gamFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.gamFit.md)
  :

  Obtaining forecasts on a test set from a fitted `gamFit`

- [`predict(`*`<lmFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.lmFit.md)
  :

  Obtaining forecasts on a test set from a fitted `lmFit`

- [`predict(`*`<cgaim>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.cgaim.md)
  : Predictions from a fitted CGAIM object - copied from
  cgaim:::predict.cgaim() and modified

## Point estimate accuracy measures

Calculate point estimate accuracy measures.

- [`MAE()`](https://nuwani-palihawadana.github.io/smimodel/reference/point_measures.md)
  [`MSE()`](https://nuwani-palihawadana.github.io/smimodel/reference/point_measures.md)
  [`point_measures`](https://nuwani-palihawadana.github.io/smimodel/reference/point_measures.md)
  : Point estimate accuracy measures

## Prediction Intervals

Functions to construct and evaluate prediction intervals in time series
forecasting problems.

- [`bb_cvforecast()`](https://nuwani-palihawadana.github.io/smimodel/reference/bb_cvforecast.md)
  : Single season block bootstrap prediction intervals through time
  series cross-validation forecasting
- [`cb_cvforecast()`](https://nuwani-palihawadana.github.io/smimodel/reference/cb_cvforecast.md)
  : Conformal bootstrap prediction intervals through time series
  cross-validation forecasting
- [`avgCoverage()`](https://nuwani-palihawadana.github.io/smimodel/reference/avgCoverage.md)
  : Calculate interval forecast coverage
- [`avgWidth()`](https://nuwani-palihawadana.github.io/smimodel/reference/avgWidth.md)
  : Calculate interval forecast width

## Other user-facing functions

Other exported functions that can be called by users.

- [`autoplot(`*`<smimodel>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/autoplot.smimodel.md)
  :

  Plot estimated smooths from a fitted `smimodel`

- [`residuals(`*`<smimodel>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/residuals.smimodel.md)
  :

  Extract residuals from a fitted `smimodel`

- [`lag_matrix()`](https://nuwani-palihawadana.github.io/smimodel/reference/lag_matrix.md)
  : Function for adding lags of time series variables

- [`print(`*`<smimodel>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/print.smimodel.md)
  :

  Printing a `smimodel` object

- [`print(`*`<smimodelFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/print.smimodelFit.md)
  :

  Printing a `smimodelFit` object

- [`print(`*`<backward>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/print.backward.md)
  :

  Printing a `backward` object

- [`print(`*`<gaimFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/print.gaimFit.md)
  :

  Printing a `gaimFit` object

- [`print(`*`<pprFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/print.pprFit.md)
  :

  Printing a `pprFit` object

- [`forecast(`*`<smimodel>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/forecast.smimodel.md)
  : Forecasting using SMI models

- [`forecast(`*`<backward>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/forecast.backward.md)
  : Forecasting using nonparametric additive models with backward
  elimination

- [`forecast(`*`<gaimFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/forecast.gaimFit.md)
  : Forecasting using GAIMs

- [`forecast(`*`<pprFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/forecast.pprFit.md)
  : Forecasting using PPR models

- [`forecast(`*`<gamFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/forecast.gamFit.md)
  : Forecasting using GAMs

## Other non-user-facing functions

Other internal functions that are not exported.

- [`smimodel.fit()`](https://nuwani-palihawadana.github.io/smimodel/reference/smimodel.fit.md)
  : SMI model estimation

- [`new_smimodelFit()`](https://nuwani-palihawadana.github.io/smimodel/reference/new_smimodelFit.md)
  :

  Constructor function for the class `smimodelFit`

- [`update_smimodelFit()`](https://nuwani-palihawadana.github.io/smimodel/reference/update_smimodelFit.md)
  :

  Updating a `smimodelFit`

- [`make_smimodelFit()`](https://nuwani-palihawadana.github.io/smimodel/reference/make_smimodelFit.md)
  :

  Converting a fitted `gam` object to a `smimodelFit` object

- [`inner_update()`](https://nuwani-palihawadana.github.io/smimodel/reference/inner_update.md)
  : Updating index coefficients and non-linear functions iteratively

- [`init_alpha()`](https://nuwani-palihawadana.github.io/smimodel/reference/init_alpha.md)
  : Initialising index coefficients

- [`update_alpha()`](https://nuwani-palihawadana.github.io/smimodel/reference/update_alpha.md)
  : Updating index coefficients using MIP

- [`greedy.fit()`](https://nuwani-palihawadana.github.io/smimodel/reference/greedy.fit.md)
  : Greedy search for tuning penalty parameters

- [`tune_smimodel()`](https://nuwani-palihawadana.github.io/smimodel/reference/tune_smimodel.md)
  : SMI model with a given penalty parameter combination

- [`normalise_alpha()`](https://nuwani-palihawadana.github.io/smimodel/reference/normalise_alpha.md)
  : Scaling index coefficient vectors to have unit norm

- [`loss()`](https://nuwani-palihawadana.github.io/smimodel/reference/loss.md)
  : Calculating the loss of the MIP used to estimate a SMI model

- [`allpred_index()`](https://nuwani-palihawadana.github.io/smimodel/reference/allpred_index.md)
  : Constructing index coefficient vectors with all predictors in each
  index

- [`split_index()`](https://nuwani-palihawadana.github.io/smimodel/reference/split_index.md)
  : Splitting predictors into multiple indices

- [`scaling()`](https://nuwani-palihawadana.github.io/smimodel/reference/scaling.md)
  : Scale data

- [`unscaling()`](https://nuwani-palihawadana.github.io/smimodel/reference/unscaling.md)
  :

  Unscale a fitted `smimodel`

- [`augment(`*`<smimodelFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/augment.smimodelFit.md)
  :

  Augment function for class `smimodelFit`

- [`predict(`*`<smimodelFit>`*`)`](https://nuwani-palihawadana.github.io/smimodel/reference/predict.smimodelFit.md)
  :

  Obtaining forecasts on a test set from a `smimodelFit`

- [`predict_gam()`](https://nuwani-palihawadana.github.io/smimodel/reference/predict_gam.md)
  :

  Obtaining recursive forecasts on a test set from a fitted
  [`mgcv::gam`](https://rdrr.io/pkg/mgcv/man/gam.html)

- [`eliminate()`](https://nuwani-palihawadana.github.io/smimodel/reference/eliminate.md)
  : Eliminate a variable and fit a nonparametric additive model

- [`blockBootstrap()`](https://nuwani-palihawadana.github.io/smimodel/reference/blockBootstrap.md)
  : Futures through single season block bootstrapping

- [`residBootstrap()`](https://nuwani-palihawadana.github.io/smimodel/reference/residBootstrap.md)
  : Generate multiple single season block bootstrap series

- [`seasonBootstrap()`](https://nuwani-palihawadana.github.io/smimodel/reference/seasonBootstrap.md)
  : Single season block bootstrap

- [`randomBlock()`](https://nuwani-palihawadana.github.io/smimodel/reference/randomBlock.md)
  : Randomly sampling a block

- [`possibleFutures_smimodel()`](https://nuwani-palihawadana.github.io/smimodel/reference/possibleFutures_smimodel.md)
  :

  Possible future sample paths (multi-step) from `smimodel` residuals

- [`possibleFutures_benchmark()`](https://nuwani-palihawadana.github.io/smimodel/reference/possibleFutures_benchmark.md)
  : Possible future sample paths (multi-step) from residuals of a fitted
  benchmark model

- [`prep_newdata()`](https://nuwani-palihawadana.github.io/smimodel/reference/prep_newdata.md)
  : Prepare a data set for recursive forecasting

- [`remove_lags()`](https://nuwani-palihawadana.github.io/smimodel/reference/remove_lags.md)
  : Remove actual values from a data set for recursive forecasting

- [`truncate_vars()`](https://nuwani-palihawadana.github.io/smimodel/reference/truncate_vars.md)
  : Truncating predictors to be in the in-sample range

## Package metadata

Package information.

- [`smimodel`](https://nuwani-palihawadana.github.io/smimodel/reference/smimodel-package.md)
  [`smimodel-package`](https://nuwani-palihawadana.github.io/smimodel/reference/smimodel-package.md)
  : smimodel: Sparse Multiple Index Models for Nonparametric Forecasting

# Articles

### All vignettes

- [Introduction to
  smimodel](https://nuwani-palihawadana.github.io/smimodel/articles/smimodel.md):
